<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kokoro TTS Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        .tab-active { border-bottom: 2px solid #3b82f6; color: #3b82f6; }
        html, body { height: 100%; overflow: hidden; }
        #app { height: 100%; display: flex; flex-direction: column; }
        .tab-content-scroll {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-bottom: 2rem;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans">
    <div id="app" class="w-full h-full">
        <header class="px-4 sm:px-6 lg:px-8 py-4 bg-gray-900 border-b border-gray-700 flex-shrink-0">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-100">Kokoro TTS Dashboard</h1>
                <div class="flex items-center gap-2">
                    <span class="w-3 h-3 rounded-full" :class="connected ? 'bg-green-500' : 'bg-red-500'"></span>
                    <span class="text-sm text-gray-400">{{ connected ? 'Connected' : 'Disconnected' }}</span>
                </div>
            </div>
        </header>

        <!-- Tabs -->
        <div class="flex border-b border-gray-700 px-4 sm:px-6 lg:px-8 bg-gray-900 flex-shrink-0">
            <button @click="activeTab = 'status'" :class="{'tab-active': activeTab === 'status'}" class="px-4 sm:px-6 py-3 font-medium text-gray-300 hover:text-blue-400">Status</button>
            <button @click="activeTab = 'history'" :class="{'tab-active': activeTab === 'history'}" class="px-4 sm:px-6 py-3 font-medium text-gray-300 hover:text-blue-400">History</button>
            <button @click="activeTab = 'control'" :class="{'tab-active': activeTab === 'control'}" class="px-4 sm:px-6 py-3 font-medium text-gray-300 hover:text-blue-400">Control</button>
        </div>

        <!-- Tab Content Container -->
        <div class="tab-content-scroll px-4 sm:px-6 lg:px-8 py-6">
            <!-- Status Tab -->
            <div v-if="activeTab === 'status'" class="space-y-6 max-w-7xl mx-auto">
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4">Current State</h2>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-sm text-gray-400">Status</p>
                        <p class="text-lg font-medium capitalize" :class="status.status === 'processing' ? 'text-green-400' : 'text-gray-300'">{{ status.status }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-400">Default Voice</p>
                        <p class="text-lg font-medium text-gray-300">{{ status.default_voice }}</p>
                    </div>
                </div>
            </div>

            <div class="bg-gray-800 p-6 rounded-lg shadow-lg" v-if="status.status === 'processing'">
                <h2 class="text-xl font-semibold mb-4">Currently Speaking</h2>
                <div class="p-4 bg-gray-700 rounded border border-gray-600">
                    <p class="text-lg leading-relaxed">{{ status.current_text }}</p>
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div v-if="activeTab === 'history'" class="space-y-4 max-w-7xl mx-auto">
            <div v-for="item in history" :key="item.id" class="bg-gray-800 p-4 rounded-lg shadow-lg flex justify-between items-start">
                <div class="flex-1 min-w-0">
                    <p class="text-gray-200 font-medium break-words">{{ item.text }}</p>
                    <div class="flex gap-4 text-sm text-gray-400 mt-1">
                        <span>{{ new Date(item.timestamp).toLocaleTimeString() }}</span>
                        <span>Voice: {{ item.voice }}</span>
                        <span>Speed: {{ item.speed }}x</span>
                    </div>
                </div>
                <button @click="replay(item.id)" class="ml-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition flex-shrink-0">
                    Replay
                </button>
            </div>
            <div v-if="history.length === 0" class="text-center text-gray-500 py-8">No history available</div>
        </div>

        <!-- Control Tab -->
        <div v-if="activeTab === 'control'" class="space-y-6 max-w-7xl mx-auto">
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4">Voice Settings</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-1">Default Voice</label>
                        <select v-model="selectedVoice" class="w-full p-2 border border-gray-600 bg-gray-700 text-gray-200 rounded">
                            <option v-for="voice in voices" :key="voice" :value="voice">{{ voice }}</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-1">Default Speed</label>
                        <div class="flex items-center gap-3">
                            <input type="range" v-model="selectedSpeed" min="0.5" max="2.0" step="0.1" class="flex-1">
                            <span class="text-sm font-medium text-gray-300 min-w-[3rem]">{{ selectedSpeed }}x</span>
                        </div>
                    </div>
                    <button @click="setDefaults" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save Defaults</button>
                </div>
            </div>

            <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4">Playback Control</h2>
                <div class="grid grid-cols-3 gap-3">
                    <button @click="pause" class="px-4 py-3 bg-yellow-600 text-white rounded font-bold hover:bg-yellow-700">PAUSE</button>
                    <button @click="resume" class="px-4 py-3 bg-green-600 text-white rounded font-bold hover:bg-green-700">RESUME</button>
                    <button @click="stop" class="px-4 py-3 bg-red-600 text-white rounded font-bold hover:bg-red-700">STOP</button>
                </div>
            </div>

            <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4">Kokoro Server</h2>
                <div class="grid grid-cols-2 gap-3">
                    <button @click="startKokoro" class="px-4 py-3 bg-emerald-600 text-white rounded font-bold hover:bg-emerald-700">START SERVER</button>
                    <button @click="stopKokoro" class="px-4 py-3 bg-orange-600 text-white rounded font-bold hover:bg-orange-700">STOP SERVER</button>
                </div>
            </div>

            <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold mb-4">Quick Speech</h2>
                <div class="space-y-3">
                    <textarea v-model="quickText" placeholder="Type text to speak..." class="w-full p-3 border border-gray-600 bg-gray-700 text-gray-200 rounded resize-none" rows="3"></textarea>
                    <button @click="speakNow" class="w-full px-4 py-3 bg-purple-600 text-white rounded font-bold hover:bg-purple-700">SAY IT NOW</button>
                </div>
            </div>
        </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                const activeTab = ref('status');
                const connected = ref(false);
                const status = ref({ status: 'idle', current_text: '', default_voice: 'af_heart' });
                const history = ref([]);
                const selectedVoice = ref('af_heart');
                const selectedSpeed = ref(1.0);
                const quickText = ref('');
                const voices = [
                    'af_heart', 'af_bella', 'af_nicole', 'af_sarah', 'af_sky',
                    'am_adam', 'am_michael',
                    'bf_emma', 'bf_isabella', 'bm_george', 'bm_lewis'
                ];

                const API_URL = 'http://localhost:3021/api'; // Adjust if needed
                const WS_URL = 'ws://localhost:3021';

                const connectWS = () => {
                    const ws = new WebSocket(WS_URL);
                    ws.onopen = () => connected.value = true;
                    ws.onclose = () => {
                        connected.value = false;
                        setTimeout(connectWS, 2000);
                    };
                    ws.onmessage = (event) => {
                        const msg = JSON.parse(event.data);
                        if (msg.type === 'status') {
                            status.value = msg.data;
                            selectedVoice.value = msg.data.default_voice;
                        } else if (msg.type === 'history') {
                            history.value = msg.data;
                        }
                    };
                };

                const replay = async (id) => {
                    await fetch(`${API_URL}/replay`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ id })
                    });
                };

                const setDefaults = async () => {
                    try {
                        const response = await fetch(`${API_URL}/control`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                command: 'set_defaults',
                                voice: selectedVoice.value,
                                speed: parseFloat(selectedSpeed.value)
                            })
                        });
                        if (!response.ok) console.error('Failed to set defaults');
                    } catch (error) {
                        console.error('Error setting defaults:', error);
                    }
                };

                const pause = async () => {
                    try {
                        const response = await fetch(`${API_URL}/control`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ command: 'pause' })
                        });
                        if (!response.ok) console.error('Failed to pause');
                    } catch (error) {
                        console.error('Error pausing:', error);
                    }
                };

                const resume = async () => {
                    try {
                        const response = await fetch(`${API_URL}/control`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ command: 'resume' })
                        });
                        if (!response.ok) console.error('Failed to resume');
                    } catch (error) {
                        console.error('Error resuming:', error);
                    }
                };

                const stop = async () => {
                    try {
                        const response = await fetch(`${API_URL}/control`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ command: 'stop' })
                        });
                        if (!response.ok) console.error('Failed to stop');
                    } catch (error) {
                        console.error('Error stopping:', error);
                    }
                };

                const startKokoro = async () => {
                    try {
                        const response = await fetch(`${API_URL}/server`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ command: 'start' })
                        });
                        if (!response.ok) console.error('Failed to start Kokoro server');
                    } catch (error) {
                        console.error('Error starting Kokoro server:', error);
                    }
                };

                const stopKokoro = async () => {
                    try {
                        const response = await fetch(`${API_URL}/server`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ command: 'stop' })
                        });
                        if (!response.ok) console.error('Failed to stop Kokoro server');
                    } catch (error) {
                        console.error('Error stopping Kokoro server:', error);
                    }
                };

                const speakNow = async () => {
                    if (!quickText.value.trim()) {
                        alert('Please enter some text to speak');
                        return;
                    }
                    try {
                        const response = await fetch(`${API_URL}/speak`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ 
                                text: quickText.value,
                                voice: selectedVoice.value,
                                speed: parseFloat(selectedSpeed.value)
                            })
                        });
                        if (response.ok) {
                            quickText.value = '';
                        } else {
                            console.error('Failed to speak text');
                        }
                    } catch (error) {
                        console.error('Error speaking:', error);
                    }
                };

                onMounted(() => {
                    connectWS();
                });

                return {
                    activeTab, connected, status, history, voices, selectedVoice, selectedSpeed, quickText,
                    replay, setDefaults, pause, resume, stop, startKokoro, stopKokoro, speakNow
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
